<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinel-2 Image Comparison</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css"/>
    <style>
        /* Basic styling for your page */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
            background-color: #f4f4f4;
            color: #333;
        }
        h1 {
            color: #0056b3;
            margin-bottom: 10px;
        }
        h2 {
            color: #0056b3;
            margin-top: 30px;
            margin-bottom: 10px;
            font-size: 1.5em;
        }
        p {
            margin-top: 20px;
            line-height: 1.6;
            max-width: 900px; /* Constrain paragraph width for readability */
            margin-left: auto;
            margin-right: auto;
            text-align: left; /* Align text left within its constrained width */
        }
        ul {
            list-style: none; /* Remove default bullet points */
            padding: 0;
            max-width: 900px; /* Constrain list width for readability */
            margin-left: auto;
            margin-right: auto;
            text-align: left; /* Align list items left */
        }
        ul li {
            margin-bottom: 8px;
            padding-left: 20px; /* Indent list items */
            position: relative;
        }
        ul li::before {
            content: "â€¢"; /* Custom bullet point */
            color: #0056b3;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }


        /* Styles for the comparison slider itself */
        img-comparison-slider {
            max-width: 900px;
            margin: 30px auto 0; /* Adjusted margin-bottom to 0 for credit alignment */
            height: auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden; /* Important for border-radius to apply correctly */
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            img-comparison-slider {
                max-width: 100%;
                margin: 20px 10px 0; /* Adjusted margin-bottom to 0 for credit alignment */
            }
            p, ul {
                margin-left: 10px;
                margin-right: 10px;
            }
        }

        /* Adjust image styling within the slider if needed */
        img-comparison-slider img {
            display: block;
            width: 100%;
            height: auto;
        }

        /* --- CSS for Overlay Text --- */
        /* These styles are applied to the <div> that wraps the image and text */
        img-comparison-slider [slot="first"] > div,
        img-comparison-slider [slot="second"] > div {
            position: relative; /* Essential for absolute positioning of child text */
            width: 100%; /* Ensure the wrapper fills the slot */
            height: 100%; /* Ensure the wrapper fills the slot */
            display: flex; /* Use flexbox to correctly position children */
            align-items: flex-end; /* Align content to the bottom */
        }

        /* For the second slot, align content to the right */
        img-comparison-slider [slot="second"] > div {
            justify-content: flex-end; /* Align image and text to the right for the second slot */
        }


        .image-overlay-text {
            position: absolute;
            bottom: 10px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            z-index: 10;
            pointer-events: none;
            white-space: nowrap;
            transform: translateX(0%);
            left: 10px;
        }

        img-comparison-slider [slot="second"] .image-overlay-text {
            left: auto;
            right: 10px;
        }


        /* --- CSS for Credit Text --- */
        .image-credit {
            max-width: 900px; /* Match slider width */
            margin: 5px auto 15px; /* Reduced margin-bottom */
            font-size: 0.85em; /* Smaller font */
            color: #666; /* Gray text */
            text-align: right; /* Align to the right */
            padding: 0 10px; /* Small horizontal padding */
        }

        @media (max-width: 768px) {
            .image-credit {
                margin: 5px 10px 15px; /* Adjust margin for smaller screens */
                text-align: center; /* Center on smaller screens if preferred */
            }
        }

        /* --- CSS for Legend --- */
        .legend-container {
            max-width: 900px;
            margin: 10px auto 30px;
            text-align: left;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 5px 15px;
        }

        .legend-container h3 {
            grid-column: 1 / -1;
            margin-top: 0;
            color: #0056b3;
            font-size: 1.1em;
            margin-bottom: 10px;
            text-align: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0px;
        }

        .legend-color-box {
            width: 16px;
            height: 16px;
            border: 1px solid #ccc;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .legend-item span {
            font-size: 0.85em;
            color: #555;
            line-height: 1.2;
        }

        /* --- NEW CSS for Classification Display --- */
        #classification-info {
            max-width: 900px;
            margin: 15px auto;
            padding: 10px 20px;
            background-color: #e6f7ff; /* Light blue background */
            border: 1px solid #91d5ff;
            border-radius: 5px;
            font-size: 1.1em;
            color: #0056b3;
            min-height: 30px; /* Ensure it doesn't collapse */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Hide the canvas from view */
        #hiddenCanvas {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Sentinel-2 Imagery Comparison</h1>

    <p>
        Explore the difference between a true-color Sentinel-2 satellite image and its corresponding land cover classification. Drag the slider bar to reveal more of either the original satellite view or the classified land cover map.
    </p>

    <img-comparison-slider id="comparisonSlider">
        <div slot="first">
            <img src="images/S2TrueColor.PNG" alt="Sentinel-2 True Color Image" />
            <span class="image-overlay-text">True Color</span>
        </div>

        <div slot="second" id="landCoverSlot">
            <img src="images/S2LandCoverClass.PNG" alt="Sentinel-2 Land Cover Classification" />
            <span class="image-overlay-text">Land Cover Classification</span>
        </div>
    </img-comparison-slider>

    <div id="classification-info">
        Hover over the Land Cover Classification image to see the class.
    </div>

    <div class="image-credit">
        Credit: Aaron Perry, derived from Sentinel-2 data.
    </div>

    <div class="legend-container">
        <h3>Land Cover Classes Legend</h3>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #e0e0e0;"></div><span>0: Unclassified</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #d3d3d3;"></div><span>1: Clouds / Haze</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #87ceeb;"></div><span>2: Water</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #ffffff; border: 1px solid #ccc;"></div><span>3: Snow / Ice</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #696969;"></div><span>4: Cloud Shadows</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #006400;"></div><span>5: Dense Conifer Forest</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #808080;"></div><span>6: Roadways</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #008000;"></div><span>8: Dense Forest</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #98fb98;"></div><span>9: Low Vegetation</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #d2b48c;"></div><span>10: Bare Rock</span>
        </div>
        <div class="legend-item">
            <div class="legend-color-box" style="background-color: #ffc27f;"></div><span>11: Bare Soil</span>
        </div>
    </div>
    <p>
        Satellite imagery offers invaluable insights into our planet. The Sentinel-2 mission, a part of the European Union's Copernicus programme, provides high-resolution optical imagery for land monitoring, emergency services, and security. Below, we detail how these specific image products are created.
    </p>

    <h2>True Color Composite</h2>
    <p>
        A True Color composite image is created by combining specific spectral bands to visually represent the Earth's surface as it would appear to the human eye. This type of composite is often referred to as a "natural color" image.
    </p>
    <ul>
        <li><strong>Red Band (B4):</strong> Corresponds to the red part of the electromagnetic spectrum. Healthy vegetation absorbs red light strongly, while bare soil and urban areas reflect it more.</li>
        <li><strong>Green Band (B3):</strong> Corresponds to the green part of the electromagnetic spectrum. Vegetation reflects green light, which is why healthy plants appear green.</li>
        <li><strong>Blue Band (B2):</strong> Corresponds to the blue part of the electromagnetic spectrum. Water bodies tend to absorb blue light, while aerosols and haze scatter it.</li>
    </ul>
    <p>
        By assigning the Red band to the Red color channel of the display, the Green band to the Green color channel, and the Blue band to the Blue color channel (i.e., **RGB = B4, B3, B2**), we get an image that closely resembles what we would see from space. This makes it ideal for general visualization, identifying urban areas, bare ground, and recognizing cloud formations.
    </p>

    <h2>Land Cover Classification</h2>
    <p>
        A Land Cover Classification image is a thematic map derived from **Sentinel-2 L2A satellite data**, where each pixel is assigned to a specific land cover class based on its spectral characteristics. Unlike True Color images, which are direct representations of light reflection, classification images are the result of advanced data analysis and machine learning algorithms.
    </p>
    <ul>
        <li><strong>Data Source:</strong> The classification is typically performed using multiple spectral bands from Sentinel-2, often including:
            <ul>
                <li>Visible bands (Blue, Green, Red)</li>
                <li>Near-Infrared (NIR) bands (e.g., B8, B8A): Highly sensitive to vegetation health and density.</li>
                <li>Shortwave Infrared (SWIR) bands (e.g., B11, B12): Useful for distinguishing between different types of vegetation, soil moisture, and bare ground.</li>
            </ul>
        </li>
        <li><strong>Classification Process:</strong> Algorithms analyze the unique spectral signature (how different land cover types reflect and absorb light across various bands) of each pixel. This involves training the algorithm with known samples of different land cover types (e.g., forest, water, urban, agriculture).</li>
        <li><strong>Output:</strong> Each pixel is then assigned a color that represents its classified land cover type (e.g., dark green for dense forest, light green for grassland, grey for urban areas, blue for water, etc.). The specific colors used depend on the classification scheme.</li>
    </ul>
    <p>
        Land Cover Classification images are crucial for environmental monitoring, urban planning, agriculture management, and understanding ecological changes over time. They provide a simplified yet powerful thematic view of the landscape.
    </p>

    <script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js"></script>

    <script>
        // --- Setup for Classification Lookup ---
        const landCoverImageSrc = 'images/S2LandCoverClass.PNG';
        const hiddenCanvas = document.createElement('canvas'); // Create a hidden canvas
        const ctx = hiddenCanvas.getContext('2d');
        const img = new Image();
        img.src = landCoverImageSrc;
        img.crossOrigin = "Anonymous"; // Essential for local file access if hosted differently, but generally good practice

        const classificationInfoDiv = document.getElementById('classification-info');
        const landCoverSlot = document.getElementById('landCoverSlot'); // The <div> element that holds the Land Cover image in the slider

        // Define the color mapping for your legend
        const classColors = [
            { r: 224, g: 224, b: 224, name: '0: Unclassified' },      // Light Gray
            { r: 211, g: 211, b: 211, name: '1: Clouds / Haze' },     // Lighter Gray
            { r: 135, g: 206, b: 235, name: '2: Water' },             // Sky Blue
            { r: 255, g: 255, b: 255, name: '3: Snow / Ice' },        // White
            { r: 105, g: 105, b: 105, name: '4: Cloud Shadows' },     // Dim Gray
            { r: 0, g: 100, b: 0, name: '5: Dense Conifer Forest' }, // Dark Green
            { r: 128, g: 128, b: 128, name: '6: Roadways' },          // Gray
            { r: 0, g: 128, b: 0, name: '8: Dense Forest' },         // Green
            { r: 152, g: 251, b: 152, name: '9: Low Vegetation' },    // Pale Green
            { r: 210, g: 180, b: 140, name: '10: Bare Rock' },        // Tan
            { r: 255, g: 194, b: 127, name: '11: Bare Soil' }         // Peach/Orange
            // Note: These RGB values are approximations based on common color names.
            // For precise matching, you'd need the exact RGB values used to generate the image.
        ];

        // Function to calculate color distance (Euclidean distance in RGB space)
        function getColorDistance(rgb1, rgb2) {
            return Math.sqrt(
                Math.pow(rgb1.r - rgb2.r, 2) +
                Math.pow(rgb1.g - rgb2.g, 2) +
                Math.pow(rgb1.b - rgb2.b, 2)
            );
        }

        // Function to find the closest class name for an RGB value
        function getClassNameForRGB(r, g, b) {
            const pixelColor = { r, g, b };
            let closestClass = 'Unknown Classification';
            let minDistance = Infinity;
            const tolerance = 50; // You can adjust this tolerance for fuzzy matching

            for (const classColor of classColors) {
                const distance = getColorDistance(pixelColor, classColor);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestClass = classColor.name;
                }
            }

            // If the closest match is still too far, it might be genuinely unclassified or an outlier
            if (minDistance > tolerance) {
                // If there's an 'Unclassified' class in your legend, you can return that
                // Otherwise, 'Unknown Classification' is a good fallback.
                return 'Unknown Classification (or a variant not in legend)';
            }
            return closestClass;
        }

        // When the hidden image loads, draw it onto the canvas
        img.onload = function() {
            hiddenCanvas.width = img.width;
            hiddenCanvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            console.log('Land Cover Classification image loaded onto hidden canvas.');
        };

        // Event listener for mouse movement on the visible Land Cover image slot
        landCoverSlot.addEventListener('mousemove', function(e) {
            if (img.complete) { // Ensure image is loaded before trying to read pixels
                // Get the bounding rectangle of the visible image slot
                const rect = landCoverSlot.querySelector('img').getBoundingClientRect();
                
                // Calculate mouse position relative to the visible image
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // Scale the coordinates to the original image dimensions
                // The visible image might be scaled by CSS, so we need to map mouse coords
                // from the *displayed size* to the *original pixel size* of the image
                const imgNaturalWidth = img.naturalWidth;
                const imgNaturalHeight = img.naturalHeight;
                const displayedWidth = rect.width;
                const displayedHeight = rect.height;

                const scaledX = Math.floor((x / displayedWidth) * imgNaturalWidth);
                const scaledY = Math.floor((y / displayedHeight) * imgNaturalHeight);

                // Ensure coordinates are within canvas bounds
                if (scaledX >= 0 && scaledX < hiddenCanvas.width && scaledY >= 0 && scaledY < hiddenCanvas.height) {
                    const pixel = ctx.getImageData(scaledX, scaledY, 1, 1).data;
                    const r = pixel[0];
                    const g = pixel[1];
                    const b = pixel[2];
                    // pixel[3] is alpha, not typically used for classification lookup

                    const className = getClassNameForRGB(r, g, b);
                    classificationInfoDiv.textContent = `(${scaledX}, ${scaledY}) - Class: ${className} (RGB: ${r}, ${g}, ${b})`;
                } else {
                    classificationInfoDiv.textContent = 'Hover over the Land Cover Classification image to see the class.';
                }
            }
        });

        // Clear the info when mouse leaves the image slot
        landCoverSlot.addEventListener('mouseleave', function() {
            classificationInfoDiv.textContent = 'Hover over the Land Cover Classification image to see the class.';
        });
    </script>
</body>
</html>
